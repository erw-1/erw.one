<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Vector Tiles in Leaflet JS</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- MapTiler SDK & Leaflet plugin -->
  <script src="https://cdn.maptiler.com/maptiler-sdk-js/v3.2.0/maptiler-sdk.umd.min.js"></script>
  <link  href="https://cdn.maptiler.com/maptiler-sdk-js/v3.2.0/maptiler-sdk.css" rel="stylesheet"/>
  <script src="https://cdn.maptiler.com/leaflet-maptilersdk/v4.0.2/leaflet-maptilersdk.umd.min.js"></script>

  <!-- leaflet-simple-locate plugin -->
  <script src="dist/leaflet-simple-locate.min.js"></script>
  <link rel="stylesheet" href="examples/demo.css" />


  <style>
    #map{position:absolute;top:0;right:0;bottom:0;left:0;}
  </style>
</head>
<body>
<div id="map"></div>
<script>
  function set_viewport() {
      document.documentElement.style.setProperty("--vh", window.innerHeight * 0.01 + "px");
  }

  set_viewport();
  window.addEventListener("resize", set_viewport);
  
  const key          = 'DtDN2wXXOhEt4LdQmFMi';
  const styleAmongus = '0196f288-9a46-7cfe-9c43-b6693619c7e9';
  const map          = L.map('map').setView([0,0], 1);

  L.maptiler.maptilerLayer({
    apiKey: key,
    style : styleAmongus,
    maxDetailZoom: 15
  }).addTo(map);

  // leaflet-simple-locate
  const control = new L.Control.SimpleLocate({
            position: "topleft",
            className: "button-locate",
            afterClick: (result) => {
                console.log("afterClick", result);
                if (!result.geolocation) console.log("Geolocation Error");
                if (!result.orientation) console.log("Orientation Error");
            },
            afterMarkerAdd: () => {
                console.log("afterMarkerAdded");
                const elem = document.getElementById("leaflet-simple-locate-icon-spot");
                if (elem) {
                    elem.addEventListener("click", (event) => {
                        const latlng = control.getLatLng();
                        const latlng_str = `geolocation: [${Math.round(latlng.lat * 100000) / 100000}, ${Math.round(latlng.lng * 100000) / 100000}]`;

                        const accuracy = control.getAccuracy();
                        const accuracy_str = `accuracy: ${Math.round(accuracy)} meter`;

                        const angle = control.getAngle();
                        const angle_str = `orientation: ${Math.round(angle)} degree`;

                        L.popup()
                            .setLatLng(latlng)
                            .setContent(`<p style="margin: 0.25rem 0 0.25rem 0">${latlng_str}</p><p style="margin: 0.25rem 0 0.25rem 0">${accuracy_str}</p><p style="margin: 0.25rem 0 0.25rem 0">${angle_str}</p>`)
                            .openOn(map);

                        event.stopPropagation();
                        event.preventDefault();
                    });
                }
            },
        }).addTo(map);
   JS – with hubs & playzones</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- MapTiler SDK & Leaflet plugin -->
  <script src="https://cdn.maptiler.com/maptiler-sdk-js/v3.2.0/maptiler-sdk.umd.min.js"></script>
  <link  href="https://cdn.maptiler.com/maptiler-sdk-js/v3.2.0/maptiler-sdk.css" rel="stylesheet"/>
  <script src="https://cdn.maptiler.com/leaflet-maptilersdk/v4.0.2/leaflet-maptilersdk.umd.min.js"></script>

  <!-- leaflet-simple-locate plugin -->
  <!-- Make sure the path below is correct for your project structure -->
  <script src="dist/leaflet-simple-locate.min.js"></script>
  <link rel="stylesheet" href="examples/demo.css" />

  <style>
    #map{position:absolute;top:0;right:0;bottom:0;left:0;}
  </style>
</head>
<body>
<div id="map"></div>
<script>
  /**
   * Helper to keep 100‑vh on mobile browsers 📱
   */
  function set_viewport() {
      document.documentElement.style.setProperty("--vh", window.innerHeight * 0.01 + "px");
  }
  set_viewport();
  window.addEventListener("resize", set_viewport);

  /**
   * 1. Base map (MapTiler)
   */
  const key          = "DtDN2wXXOhEt4LdQmFMi";            // 🔑 ← your MapTiler API key
  const styleAmongus = "0196f288-9a46-7cfe-9c43-b6693619c7e9"; // custom style ID
  const map          = L.map("map").setView([0,0], 2);

  L.maptiler.maptilerLayer({
    apiKey: key,
    style : styleAmongus
  }).addTo(map);

  /**
   * 2. Locate‑me control (leaflet‑simple‑locate)
   */
  const locateCtl = new L.Control.SimpleLocate({
      position: "topleft",
      className: "button-locate",
      afterClick: (result) => {
          if (!result.geolocation) console.warn("Geolocation Error");
          if (!result.orientation) console.warn("Orientation Error");
      },
      afterMarkerAdd: () => {
          const spot = document.getElementById("leaflet-simple-locate-icon-spot");
          if (!spot) return;
          spot.addEventListener("click", (e) => {
              const latlng = locateCtl.getLatLng();
              const accuracy = locateCtl.getAccuracy();
              const angle = locateCtl.getAngle();
              L.popup()
                  .setLatLng(latlng)
                  .setContent(`<p style="margin:0.25rem 0"><strong>Lat/Lng:</strong> ${latlng.lat.toFixed(5)}, ${latlng.lng.toFixed(5)}</p><p style="margin:0.25rem 0"><strong>Accuracy:</strong> ${Math.round(accuracy)} m</p><p style="margin:0.25rem 0"><strong>Orientation:</strong> ${Math.round(angle)}°</p>`)
                  .openOn(map);
              e.stopPropagation();
              e.preventDefault();
          });
      },
  }).addTo(map);

  /**
   * 3. GeoJSON layers
   *    – hubs       : points (circle‑markers)
   *    – playzones : polygons (styled fill)
   */
  Promise.all([
      fetch("data/hubs.geojson").then(r => r.json()),
      fetch("data/playzones.geojson").then(r => r.json())
  ]).then(([hubsData, playzonesData]) => {

      // Hubs – point layer
      const hubsLayer = L.geoJSON(hubsData, {
          pointToLayer: (feature, latlng) => L.circleMarker(latlng, {
              radius: 6,
              fillColor: "#ff3b3b",
              color: "#ffffff",
              weight: 1,
              opacity: 1,
              fillOpacity: 0.9
          }),
          onEachFeature: (feature, layer) => {
              const props = feature.properties || {};
              const html = Object.entries(props).map(([k,v]) => `<strong>${k}</strong>: ${v}`).join("<br/>");
              if (html) layer.bindPopup(html);
          }
      }).addTo(map);

      // Playzones – polygon layer
      const playzonesLayer = L.geoJSON(playzonesData, {
          style: {
              color: "#3388ff",
              weight: 2,
              opacity: 1,
              fillOpacity: 0.25
          },
          onEachFeature: (feature, layer) => {
              const props = feature.properties || {};
              const html = Object.entries(props).map(([k,v]) => `<strong>${k}</strong>: ${v}`).join("<br/>");
              if (html) layer.bindPopup(html);
          }
      }).addTo(map);

  // Zoom to the combined extent of both layers
  const group = new L.FeatureGroup([hubsLayer, playzonesLayer]);
      map.fitBounds(group.getBounds(), {padding:[20,20]});
  }).catch(err => {
      console.error("Could not load GeoJSON files:", err);
  });

  L.DomEvent.on(window, "ondeviceorientationabsolute" in window ? "deviceorientationabsolute" : "deviceorientation", (event) => console.log(event));

</script>
</body>
</html>
